
  <!DOCTYPE html>
  <html>
    <head>
      <title>shortener.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">apps/shortener-api/src/dbs/shortener.ts</td><td class="">100.00%</td><td class="">80%</td><td class="">107</td><td class="">107</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">/**
 * The module for managing the interaction to the Shortener collection
 * @module ShortenerDb
 */

import WrapperDb from &#x27;@dbs/wrapper/WrapperDb&#x27;;
import { ShortenerType } from &#x27;@interfaces/shortener&#x27;;
import ShortenerModel from &#x27;@models/shortener&#x27;;

/**
 * Class for managing the interaction to the shortener collection
 */
class ShortenerDb extends WrapperDb {
  /**
   * Constructor of the ShortenerDB
   * @param model {Object} The shortener mongoose model
   */
  constructor(model: typeof ShortenerModel) {
    super(model);
  }

  /**
   * Save a shortener object
   * @param tmpShortened The shortener object to save to the db
   * @returns {Object} The saved shortener object
   */
  async save(tmpShortened: ShortenerType): Promise&lt;ShortenerType&gt; {
    return this.create&lt;ShortenerType&gt;(tmpShortened);
  }

  /**
   * Return a shortener gotten by the short URL
   * @param shortURL The short url of the shortener to find
   * @returns {Object} The found shortener object
   */
  async getByShortUrl({ shortURL }: ShortenerType): Promise&lt;ShortenerType&gt; {
    return this.findOne&lt;ShortenerType, { shortURL: string }&gt;({ shortURL });
  }

  /**
   * Return a shortener gotten by the long URL
   * @param longURL The long url of the shortener to find
   * @returns {Object} The found shortener object
   */
  async getByLongUrl({ longURL }: ShortenerType): Promise&lt;ShortenerType&gt; {
    return this.findOne&lt;ShortenerType, { longURL: string }&gt;({ longURL });
  }

  /**
   * Increment count of a shortener object with a certain shortURL
   * @param shortURL The short url of the shortener to find
   * @returns {Object} The updated shortener object
   */
  async incrementByShortUrl(
    { shortURL }: ShortenerType,
    field: string
  ): Promise&lt;ShortenerType&gt; {
    return this.increment&lt;ShortenerType, { shortURL: string }&gt;(
      { shortURL },
      field
    );
  }

  /**
   * Update a shortener object with a certain shortURL
   * @param shortURL The short url of the shortener to find
   * @param longURL The long url of the shortener to update with
   * @returns {Object} The updated shortener object
   */
  async updateByShortUrl({
    shortURL,
    longURL,
  }: ShortenerType): Promise&lt;ShortenerType&gt; {
    return this.update&lt;ShortenerType, { shortURL: string }&gt;(
      { shortURL },
      { longURL, isArchive: false, countUsage: 0 }
    );
  }

  /**
   * Check if a shortener object exist by is longURL and by is shortURL
   * @param shortURL The short url of the shortener to find
   * @param longURL The long url of the shortener to find
   * @returns {Object} The result of both queries
   */
  async isExist({
    longURL,
    shortURL,
  }: {
    longURL: string;
    shortURL: string;
  }): Promise&lt;{
    longURL: ShortenerType[];
    shortURL: ShortenerType[];
  }&gt; {
    const query1 = this.queryMatch&lt;{ longURL: string }&gt;({ longURL });
    const query2 = this.queryMatch&lt;{ shortURL: string }&gt;({ shortURL });
    const limit = this.queryLimit&lt;number&gt;(1);

    const result = await this.facet&lt;
      { longURL: string; shortURL: string },
      {
        longURL: ({ $match: { longURL: string } } | { $limit: number })[];
        shortURL: ({ $match: { shortURL: string } } | { $limit: number })[];
      }
    &gt;({
      longURL: [query1, limit],
      shortURL: [query2, limit],
    });

    return result[0];
  }
}

export default ShortenerDb;
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Fri, 22 Mar 2024 15:14:30 GMT</p>
    </body>
  </html>
  